{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Bienvenido al Proyecto de Modelos Probabil\u00edsticos Participantes del Proyecto de modelos Cristian Vega Romero Andres Yohel Este proyecto busca, mediante los datos de una estaci\u00f3n meteorol\u00f3gica propiedad del laboratorio LabCES (Laboratorio de Investigaci\u00f3n en Conversi\u00f3n de la Energ\u00eda para la Sustentabilidad), colocada en el techo del edificio de Ingenier\u00eda El\u00e9ctrica, conocer la radiaci\u00f3n solar producida de forma diaria y su posible uso para la creaci\u00f3n de una microrred. Para este objetivo, se deben llevar a cabo modelos predictivos con el fin de no ver limitado el uso de la electricidad para las funciones diarias en el laboratorio. Pagina del laboratorio","title":"inicio"},{"location":"#bienvenido-al-proyecto-de-modelos-probabilisticos","text":"","title":"Bienvenido al Proyecto de Modelos Probabil\u00edsticos"},{"location":"#participantes-del-proyecto-de-modelos","text":"Cristian Vega Romero Andres Yohel Este proyecto busca, mediante los datos de una estaci\u00f3n meteorol\u00f3gica propiedad del laboratorio LabCES (Laboratorio de Investigaci\u00f3n en Conversi\u00f3n de la Energ\u00eda para la Sustentabilidad), colocada en el techo del edificio de Ingenier\u00eda El\u00e9ctrica, conocer la radiaci\u00f3n solar producida de forma diaria y su posible uso para la creaci\u00f3n de una microrred. Para este objetivo, se deben llevar a cabo modelos predictivos con el fin de no ver limitado el uso de la electricidad para las funciones diarias en el laboratorio. Pagina del laboratorio","title":"Participantes del Proyecto de modelos"},{"location":"Contexto/","text":"Radiaci\u00f3n Solar La radiaci\u00f3n solar es la forma en que la energ\u00eda emitida por el sol llega a la Tierra en forma de ondas electromagn\u00e9ticas. Esta energ\u00eda es el principal factor que permite la vida en nuestro planeta, ya que proporciona la luz y el calor necesarios para los procesos biol\u00f3gicos y clim\u00e1ticos. La radiaci\u00f3n solar se compone de diferentes tipos de ondas, principalmente: Radiaci\u00f3n Ultravioleta (UV) : Tiene longitudes de onda m\u00e1s cortas y es responsable de efectos como las quemaduras solares. Radiaci\u00f3n Visible : Es la luz que podemos ver, que va desde el violeta hasta el rojo. Radiaci\u00f3n Infrarroja (IR) : Tiene longitudes de onda m\u00e1s largas y es percibida como calor. Radiaci\u00f3n Global La radiaci\u00f3n global es el conjunto de la radiaci\u00f3n directa del sol y la radiaci\u00f3n difusa del cielo. En este contexto, no solo se considera la radiaci\u00f3n global, sino tambi\u00e9n la radiaci\u00f3n del horizonte, que se mide colocando el medidor al mismo \u00e1ngulo que el panel solar. El medidor en cuesti\u00f3n es un piran\u00f3metro, el cual mide la radiaci\u00f3n global en el horizonte de los paneles solares. Este instrumento es de uso com\u00fan en estudios meteorol\u00f3gicos y clim\u00e1ticos. Aplicaciones en LabCES Para el Laboratorio de Conversi\u00f3n de Energ\u00eda (LabCES), la radiaci\u00f3n solar tiene dos aplicaciones principales. La primera es obtener un valor de eficiencia te\u00f3ricamente perfecto; al conocer la radiaci\u00f3n que llega del horizonte, se puede determinar cu\u00e1ntos watts se obtendr\u00edan con una eficiencia del 100%. La segunda aplicaci\u00f3n es para predicciones de producci\u00f3n, debido a la naturaleza predecible del sol. Los factores climatol\u00f3gicos, bien conocidos, dictan la producci\u00f3n; al medirlos y proyectar la radiaci\u00f3n solar con estos, se puede predecir con cierta certeza la potencia generada cada a\u00f1o. T\u00e9rminos de Irradiancia Solar Existen diferentes t\u00e9rminos para describir la irradiancia solar: GHI (Global Horizontal Irradiance) : Es la cantidad total de radiaci\u00f3n solar que incide sobre una superficie horizontal, incluyendo tanto la radiaci\u00f3n directa del sol como la radiaci\u00f3n difusa (dispersada por la atm\u00f3sfera). EBH (Global Beam Horizontal Irradiance) : Aunque no es un t\u00e9rmino tan com\u00fan, generalmente se refiere a la componente directa de la irradiancia solar en una superficie horizontal, similar al DNI pero ajustado a una superficie horizontal. DNI (Direct Normal Irradiance) : Es la cantidad de radiaci\u00f3n solar que llega directamente desde el sol en una superficie perpendicular a los rayos solares (orientada hacia el sol). No incluye la radiaci\u00f3n difusa. DHI (Diffuse Horizontal Irradiance) : Es la cantidad de radiaci\u00f3n solar que ha sido dispersada por mol\u00e9culas y part\u00edculas en la atm\u00f3sfera y que llega a una superficie horizontal. No incluye la radiaci\u00f3n directa del sol. Opacidad del Cielo La opacidad del cielo se refiere a la cantidad de cobertura nubosa o la fracci\u00f3n del cielo cubierto por nubes. Una mayor opacidad indica m\u00e1s nubes, lo que generalmente reduce la cantidad de radiaci\u00f3n solar directa que llega a la superficie terrestre.","title":"Contexto"},{"location":"Contexto/#radiacion-solar","text":"La radiaci\u00f3n solar es la forma en que la energ\u00eda emitida por el sol llega a la Tierra en forma de ondas electromagn\u00e9ticas. Esta energ\u00eda es el principal factor que permite la vida en nuestro planeta, ya que proporciona la luz y el calor necesarios para los procesos biol\u00f3gicos y clim\u00e1ticos. La radiaci\u00f3n solar se compone de diferentes tipos de ondas, principalmente: Radiaci\u00f3n Ultravioleta (UV) : Tiene longitudes de onda m\u00e1s cortas y es responsable de efectos como las quemaduras solares. Radiaci\u00f3n Visible : Es la luz que podemos ver, que va desde el violeta hasta el rojo. Radiaci\u00f3n Infrarroja (IR) : Tiene longitudes de onda m\u00e1s largas y es percibida como calor.","title":"Radiaci\u00f3n Solar"},{"location":"Contexto/#radiacion-global","text":"La radiaci\u00f3n global es el conjunto de la radiaci\u00f3n directa del sol y la radiaci\u00f3n difusa del cielo. En este contexto, no solo se considera la radiaci\u00f3n global, sino tambi\u00e9n la radiaci\u00f3n del horizonte, que se mide colocando el medidor al mismo \u00e1ngulo que el panel solar. El medidor en cuesti\u00f3n es un piran\u00f3metro, el cual mide la radiaci\u00f3n global en el horizonte de los paneles solares. Este instrumento es de uso com\u00fan en estudios meteorol\u00f3gicos y clim\u00e1ticos.","title":"Radiaci\u00f3n Global"},{"location":"Contexto/#aplicaciones-en-labces","text":"Para el Laboratorio de Conversi\u00f3n de Energ\u00eda (LabCES), la radiaci\u00f3n solar tiene dos aplicaciones principales. La primera es obtener un valor de eficiencia te\u00f3ricamente perfecto; al conocer la radiaci\u00f3n que llega del horizonte, se puede determinar cu\u00e1ntos watts se obtendr\u00edan con una eficiencia del 100%. La segunda aplicaci\u00f3n es para predicciones de producci\u00f3n, debido a la naturaleza predecible del sol. Los factores climatol\u00f3gicos, bien conocidos, dictan la producci\u00f3n; al medirlos y proyectar la radiaci\u00f3n solar con estos, se puede predecir con cierta certeza la potencia generada cada a\u00f1o.","title":"Aplicaciones en LabCES"},{"location":"Contexto/#terminos-de-irradiancia-solar","text":"Existen diferentes t\u00e9rminos para describir la irradiancia solar: GHI (Global Horizontal Irradiance) : Es la cantidad total de radiaci\u00f3n solar que incide sobre una superficie horizontal, incluyendo tanto la radiaci\u00f3n directa del sol como la radiaci\u00f3n difusa (dispersada por la atm\u00f3sfera). EBH (Global Beam Horizontal Irradiance) : Aunque no es un t\u00e9rmino tan com\u00fan, generalmente se refiere a la componente directa de la irradiancia solar en una superficie horizontal, similar al DNI pero ajustado a una superficie horizontal. DNI (Direct Normal Irradiance) : Es la cantidad de radiaci\u00f3n solar que llega directamente desde el sol en una superficie perpendicular a los rayos solares (orientada hacia el sol). No incluye la radiaci\u00f3n difusa. DHI (Diffuse Horizontal Irradiance) : Es la cantidad de radiaci\u00f3n solar que ha sido dispersada por mol\u00e9culas y part\u00edculas en la atm\u00f3sfera y que llega a una superficie horizontal. No incluye la radiaci\u00f3n directa del sol.","title":"T\u00e9rminos de Irradiancia Solar"},{"location":"Contexto/#opacidad-del-cielo","text":"La opacidad del cielo se refiere a la cantidad de cobertura nubosa o la fracci\u00f3n del cielo cubierto por nubes. Una mayor opacidad indica m\u00e1s nubes, lo que generalmente reduce la cantidad de radiaci\u00f3n solar directa que llega a la superficie terrestre.","title":"Opacidad del Cielo"},{"location":"datos/","text":"Diagrama de flujo para la adquisici\u00f3n de los datos. Diagrama de alarma de potencia.","title":"Recopilacion de datos"},{"location":"estadisticas/","text":"Datos obtenidos apartir de los analisis antes decriptos en la seccion de codigo An\u00e1lisis de la Irradiancia Solar Global (GHI) Generaci\u00f3n del Histograma de GHI En esta secci\u00f3n, nos enfocamos en la creaci\u00f3n de un histograma para la variable GHI (Global Horizontal Irradiance). El objetivo de este an\u00e1lisis es visualizar la distribuci\u00f3n real de los datos de GHI, lo que nos permitir\u00e1, en futuros an\u00e1lisis, definir una funci\u00f3n de densidad de probabilidad (PDF) adecuada. Objetivos Visualizaci\u00f3n de la Distribuci\u00f3n de Datos : El histograma proporciona una representaci\u00f3n gr\u00e1fica de la distribuci\u00f3n de la variable GHI. Esto nos permite observar c\u00f3mo se distribuyen los valores de irradiancia a lo largo del tiempo. Identificaci\u00f3n de Valores Clave : A trav\u00e9s del histograma, podemos identificar rangos de valores donde la irradiancia es m\u00e1s frecuente, as\u00ed como detectar la presencia de valores at\u00edpicos o extremos. Base para Modelos Probabil\u00edsticos : La comprensi\u00f3n de la distribuci\u00f3n de GHI es crucial para definir posteriormente una funci\u00f3n de densidad de probabilidad que modele estos datos de manera precisa. Procedimiento C\u00e1lculo del Histograma : Se utiliza la variable GHI para generar el histograma. Esto implica agrupar los datos en intervalos (o bins) y contar el n\u00famero de ocurrencias en cada intervalo. Visualizaci\u00f3n : El histograma resultante se visualiza para proporcionar una representaci\u00f3n clara de la distribuci\u00f3n de GHI. Interpretaci\u00f3n del Histograma Valores Altos y Bajos : El histograma mostrar\u00e1 intervalos con diferentes frecuencias, indicando los valores altos y bajos de irradiancia. Estos datos son esenciales para entender los patrones de irradiancia solar. Valores en Cero : Es posible observar intervalos con valores en cero, lo que indica periodos sin irradiancia solar, como durante la noche o en condiciones meteorol\u00f3gicas adversas. Importancia del An\u00e1lisis El an\u00e1lisis de la distribuci\u00f3n de GHI mediante histogramas es un paso fundamental en el estudio de la irradiancia solar. La informaci\u00f3n obtenida permite: Mejorar la Eficiencia de Sistemas Solares : Conocer la distribuci\u00f3n de GHI ayuda a optimizar el dise\u00f1o y la operaci\u00f3n de sistemas de energ\u00eda solar. Predicci\u00f3n de Producci\u00f3n de Energ\u00eda : La distribuci\u00f3n de GHI es un factor clave en los modelos predictivos de producci\u00f3n de energ\u00eda solar, permitiendo estimaciones m\u00e1s precisas y fiables. An\u00e1lisis de Distribuciones de Densidad de Probabilidad para GHI Se utilizan las cuatro distribuciones de densidad de probabilidad vistas en el curso con el objetivo de observar si alguna de estas toma una forma similar al histograma mencionado anteriormente. Las distribuciones consideradas son: normal, Rayleigh, uniforme y exponencial. Distribuciones Consideradas Distribuci\u00f3n Normal Esta distribuci\u00f3n es sim\u00e9trica y se caracteriza por su forma de campana, determinada por su media y desviaci\u00f3n est\u00e1ndar. Distribuci\u00f3n de Rayleigh Esta distribuci\u00f3n es adecuada para datos que representan magnitudes resultantes de componentes vectoriales independientes y normalmente distribuidos. Distribuci\u00f3n Uniforme Esta distribuci\u00f3n asume que todos los valores dentro de un intervalo espec\u00edfico tienen la misma probabilidad de ocurrencia. Distribuci\u00f3n Exponencial Esta distribuci\u00f3n modela el tiempo entre eventos en un proceso de Poisson, caracterizada por una tasa constante. Procedimiento de An\u00e1lisis El an\u00e1lisis consiste en superponer las curvas de estas distribuciones sobre el histograma de los datos de GHI para identificar cu\u00e1l se ajusta mejor a la distribuci\u00f3n observada. Este proceso ayudar\u00e1 a definir una funci\u00f3n de densidad de probabilidad que modele los datos de manera precisa y efectiva. Resultados del An\u00e1lisis con la Distribuci\u00f3n Normal Al utilizar la distribuci\u00f3n normal se llegaron a los siguientes resultados del an\u00e1lisis: Estos resultados indican que la distribuci\u00f3n normal puede ser una buena aproximaci\u00f3n para modelar los datos de GHI en su rango m\u00e1s com\u00fan, aunque se debe considerar su limitaci\u00f3n en los extremos.","title":"Estadisticas descriptivas de los datos"},{"location":"estadisticas/#datos-obtenidos-apartir-de-los-analisis-antes-decriptos-en-la-seccion-de-codigo","text":"","title":"Datos obtenidos apartir de los analisis antes decriptos en la seccion de codigo"},{"location":"estadisticas/#analisis-de-la-irradiancia-solar-global-ghi","text":"","title":"An\u00e1lisis de la Irradiancia Solar Global (GHI)"},{"location":"estadisticas/#generacion-del-histograma-de-ghi","text":"En esta secci\u00f3n, nos enfocamos en la creaci\u00f3n de un histograma para la variable GHI (Global Horizontal Irradiance). El objetivo de este an\u00e1lisis es visualizar la distribuci\u00f3n real de los datos de GHI, lo que nos permitir\u00e1, en futuros an\u00e1lisis, definir una funci\u00f3n de densidad de probabilidad (PDF) adecuada.","title":"Generaci\u00f3n del Histograma de GHI"},{"location":"estadisticas/#objetivos","text":"Visualizaci\u00f3n de la Distribuci\u00f3n de Datos : El histograma proporciona una representaci\u00f3n gr\u00e1fica de la distribuci\u00f3n de la variable GHI. Esto nos permite observar c\u00f3mo se distribuyen los valores de irradiancia a lo largo del tiempo. Identificaci\u00f3n de Valores Clave : A trav\u00e9s del histograma, podemos identificar rangos de valores donde la irradiancia es m\u00e1s frecuente, as\u00ed como detectar la presencia de valores at\u00edpicos o extremos. Base para Modelos Probabil\u00edsticos : La comprensi\u00f3n de la distribuci\u00f3n de GHI es crucial para definir posteriormente una funci\u00f3n de densidad de probabilidad que modele estos datos de manera precisa.","title":"Objetivos"},{"location":"estadisticas/#procedimiento","text":"C\u00e1lculo del Histograma : Se utiliza la variable GHI para generar el histograma. Esto implica agrupar los datos en intervalos (o bins) y contar el n\u00famero de ocurrencias en cada intervalo. Visualizaci\u00f3n : El histograma resultante se visualiza para proporcionar una representaci\u00f3n clara de la distribuci\u00f3n de GHI.","title":"Procedimiento"},{"location":"estadisticas/#interpretacion-del-histograma","text":"Valores Altos y Bajos : El histograma mostrar\u00e1 intervalos con diferentes frecuencias, indicando los valores altos y bajos de irradiancia. Estos datos son esenciales para entender los patrones de irradiancia solar. Valores en Cero : Es posible observar intervalos con valores en cero, lo que indica periodos sin irradiancia solar, como durante la noche o en condiciones meteorol\u00f3gicas adversas.","title":"Interpretaci\u00f3n del Histograma"},{"location":"estadisticas/#importancia-del-analisis","text":"El an\u00e1lisis de la distribuci\u00f3n de GHI mediante histogramas es un paso fundamental en el estudio de la irradiancia solar. La informaci\u00f3n obtenida permite: Mejorar la Eficiencia de Sistemas Solares : Conocer la distribuci\u00f3n de GHI ayuda a optimizar el dise\u00f1o y la operaci\u00f3n de sistemas de energ\u00eda solar. Predicci\u00f3n de Producci\u00f3n de Energ\u00eda : La distribuci\u00f3n de GHI es un factor clave en los modelos predictivos de producci\u00f3n de energ\u00eda solar, permitiendo estimaciones m\u00e1s precisas y fiables.","title":"Importancia del An\u00e1lisis"},{"location":"estadisticas/#analisis-de-distribuciones-de-densidad-de-probabilidad-para-ghi","text":"Se utilizan las cuatro distribuciones de densidad de probabilidad vistas en el curso con el objetivo de observar si alguna de estas toma una forma similar al histograma mencionado anteriormente. Las distribuciones consideradas son: normal, Rayleigh, uniforme y exponencial.","title":"An\u00e1lisis de Distribuciones de Densidad de Probabilidad para GHI"},{"location":"estadisticas/#distribuciones-consideradas","text":"","title":"Distribuciones Consideradas"},{"location":"estadisticas/#distribucion-normal","text":"Esta distribuci\u00f3n es sim\u00e9trica y se caracteriza por su forma de campana, determinada por su media y desviaci\u00f3n est\u00e1ndar.","title":"Distribuci\u00f3n Normal"},{"location":"estadisticas/#distribucion-de-rayleigh","text":"Esta distribuci\u00f3n es adecuada para datos que representan magnitudes resultantes de componentes vectoriales independientes y normalmente distribuidos.","title":"Distribuci\u00f3n de Rayleigh"},{"location":"estadisticas/#distribucion-uniforme","text":"Esta distribuci\u00f3n asume que todos los valores dentro de un intervalo espec\u00edfico tienen la misma probabilidad de ocurrencia.","title":"Distribuci\u00f3n Uniforme"},{"location":"estadisticas/#distribucion-exponencial","text":"Esta distribuci\u00f3n modela el tiempo entre eventos en un proceso de Poisson, caracterizada por una tasa constante.","title":"Distribuci\u00f3n Exponencial"},{"location":"estadisticas/#procedimiento-de-analisis","text":"El an\u00e1lisis consiste en superponer las curvas de estas distribuciones sobre el histograma de los datos de GHI para identificar cu\u00e1l se ajusta mejor a la distribuci\u00f3n observada. Este proceso ayudar\u00e1 a definir una funci\u00f3n de densidad de probabilidad que modele los datos de manera precisa y efectiva.","title":"Procedimiento de An\u00e1lisis"},{"location":"estadisticas/#resultados-del-analisis-con-la-distribucion-normal","text":"Al utilizar la distribuci\u00f3n normal se llegaron a los siguientes resultados del an\u00e1lisis: Estos resultados indican que la distribuci\u00f3n normal puede ser una buena aproximaci\u00f3n para modelar los datos de GHI en su rango m\u00e1s com\u00fan, aunque se debe considerar su limitaci\u00f3n en los extremos.","title":"Resultados del An\u00e1lisis con la Distribuci\u00f3n Normal"},{"location":"modelos/","text":"Introducci\u00f3n En este documento se presenta un an\u00e1lisis probabil\u00edstico de datos de radiaci\u00f3n solar usando Python. Tareas de Procesamiento de Datos con Celery Este documento describe c\u00f3mo utilizar Celery para automatizar tareas de procesamiento de datos, incluyendo la obtenci\u00f3n de datos de una API, el almacenamiento en una base de datos y el an\u00e1lisis estad\u00edstico. Importaci\u00f3n de Librer\u00edas Importamos las librer\u00edas necesarias para manejar tareas de Celery, realizar solicitudes HTTP, procesar datos y realizar an\u00e1lisis estad\u00edsticos. Explicaci\u00f3n del Planificador de Tareas test-schedule : Esta tarea ejecuta test_task cada period segundos, obteniendo datos de una API y almacen\u00e1ndolos en la base de datos. test-schedule-task : Esta tarea ejecuta schedule_task cada 60 minutos, simplemente enviando un aviso de que ha pasado una hora desde el \u00faltimo aviso. test-statistic-task : Esta tarea ejecuta statistics_task cada 1.2 * period segundos, calculando momentos estad\u00edsticos de las columnas de datos y almacen\u00e1ndolos en la base de datos. test-plotting-task : Esta tarea ejecuta plotting_task cada 1.4 * period segundos, generando un histograma y comparando diferentes distribuciones de probabilidad de los datos. ```python from celery import Celery from celery.schedules import timedelta from datetime import datetime import requests import json import configparser import numpy as np from scipy import stats from scipy.stats import (kurtosis, skew, norm, uniform, rayleigh, expon, kstest, gamma, weibull_min, lognorm) import pandas as pd import matplotlib.pyplot as plt from models import session, GeneralData, PowerData, StatisticalMetrics Datos de configuraci\u00f3n config = configparser.ConfigParser() config.read(\"pipeline.cfg\") url = config[\"api\"][\"url\"] token = config[\"api\"][\"token\"] period = int(config[\"scheduler\"][\"period\"]) Crear \"app\" de Celery app = Celery(\"tasks\", broker=\"redis://localhost\") @app.task def test_task(): response = requests.get(url) data = json.loads(response.text) for i in range(8): temp_time = data[\"estimated_actuals\"][i][\"period_end\"] UTC_timestamp = datetime.fromisoformat(temp_time[:-2]) timestamp = UTC_timestamp - timedelta(hours=6) if session.query(GeneralData).filter_by(timestamp=timestamp).first(): pass else: power_record = PowerData( ghi=data[\"estimated_actuals\"][i][\"ghi\"], ebh=data[\"estimated_actuals\"][i][\"ebh\"], dni=data[\"estimated_actuals\"][i][\"dni\"], dhi=data[\"estimated_actuals\"][i][\"dhi\"], ) session.add(power_record) session.commit() general_record = GeneralData( timestamp=timestamp, power_id=power_record.id, cloud_opacity=data[\"estimated_actuals\"][i][\"cloud_opacity\"], ) session.add(general_record) session.commit() return \"Request de datos e inseci\u00f3n en tabla exitoso!\" @app.task def schedule_task(): return \"\u00a1Ya pas\u00f3 una hora desde el ultimo aviso!\" @app.task def statistics_task(): # Paso 1: Hacer fetch a todas las columnas y asignarlas a listas. sql_obj_temp = session.query(PowerData).all() temp_general_ghi = [] temp_general_ebh = [] temp_general_dni = [] temp_general_dhi = [] for row in sql_obj_temp: temp_general_ghi.append(row.ghi) temp_general_ebh.append(row.ebh) temp_general_dni.append(row.dni) temp_general_dhi.append(row.dhi) momentos = ['media', 'varianza', 'dsv_estandar', 'inclinacion', 'kurtosis'] idx = 0 while idx < 5: # Calculo de los momentos para cada columna de datos if idx == 0: foo_momentos = np.mean elif idx == 1: foo_momentos = np.var elif idx == 2: foo_momentos = np.std elif idx == 3: foo_momentos = skew elif idx == 4: foo_momentos = kurtosis else: pass momento_ghi = foo_momentos(temp_general_ghi) momento_ebh = foo_momentos(temp_general_ebh) momento_dni = foo_momentos(temp_general_dni) momento_dhi = foo_momentos(temp_general_dhi) # Revisar si ya se ha ingresado anteriormente momentos a la tabla statistic_obj = ( session.query(StatisticalMetrics) .filter_by(metric=momentos[idx]) .first() ) if statistic_obj: statistic_obj.ghi = momento_ghi statistic_obj.ebh = momento_ebh statistic_obj.dni = momento_dni statistic_obj.dhi = momento_dhi else: statistic_obj = StatisticalMetrics( metric=momentos[idx], ghi=momento_ghi, ebh=momento_ebh, dni=momento_dni, dhi=momento_dhi, ) session.add(statistic_obj) session.commit() idx = idx + 1 @app.task def plotting_task(): sql_obj_temp = session.query(PowerData).all() temp_general_ghi = [] for row in sql_obj_temp: temp_general_ghi.append(row.ghi) series = pd.Series(temp_general_ghi) plt.hist(series, bins=30, edgecolor='black') plt.title('Histogram') plt.xlabel('Value') plt.ylabel('Frequency') plt.savefig('histogram_plot.png') plt.clf() x = np.linspace(series.min(), series.max(), 100) pdf_normal = norm.pdf(x, series.mean(), series.std()) pdf_uniform = uniform.pdf(x, series.min(), series.max() - series.min()) pdf_rayleigh = rayleigh.pdf(x, scale=series.std()) pdf_expon = expon.pdf(x, scale=series.mean()) plt.plot(x, pdf_normal, 'k', linewidth=2, label='Normal PDF') plt.plot(x, pdf_uniform, 'r', linewidth=2, label='Uniform PDF') plt.plot(x, pdf_rayleigh, 'b', linewidth=2, label='Rayleigh PDF') plt.plot(x, pdf_expon, 'm', linewidth=2, label='Exponential PDF') plt.legend() plt.title('Probability Density Functions') plt.xlabel('Value') plt.ylabel('Density') # Save the figure plt.savefig('pdf_comparison_plot.png') plt.clf() distributions = [ norm, uniform, expon, rayleigh, gamma, weibull_min, lognorm ] results = {} for distribution in distributions: params = distribution.fit(series) ks_stat, p_value = kstest(series, distribution.name, args=params) results[distribution.name] = { 'params': params, 'ks_stat': ks_stat, 'p_value': p_value } best_fit = min(results.keys(), key=lambda dist: results[dist]['ks_stat']) best_params = results[best_fit]['params'] print(f\"Mejor ajuste: {best_fit}\") print(f\"Par\u00e1metros: {best_params}\") x = np.linspace(series.min(), series.max(), 100) pdf = getattr(stats, best_fit).pdf(x, *best_params) plt.figure(figsize=(12, 8)) plt.hist( series, bins=30, density=True, alpha=0.6, color='g', label='Datos' ) plt.plot( x, pdf, 'r-', linewidth=2, label=f'{best_fit.capitalize()} PDF' ) plt.legend(loc='best') plt.title( 'Histograma de los datos y mejor ajuste de la distribuci\u00f3n' ) plt.xlabel('Valor') plt.ylabel('Densidad') plt.savefig('mejor_ajuste_distribucion.png') equation = '' if best_fit == 'norm': mu, sigma = best_params equation = ( f\"f(x) = (1 / ({sigma} * sqrt(2 * pi))) *\" \" exp(-0.5 * ((x - {mu}) / {sigma})**2)\" ) elif best_fit == 'expon': loc, scale = best_params equation = f\"f(x) = (1 / {scale}) * exp(- (x - {loc}) / {scale})\" else: equation = \"Ecuaci\u00f3n no disponible para esta distribuci\u00f3n\" print(f\"Ecuaci\u00f3n de la distribuci\u00f3n {best_fit}:\") print(equation) Configurar el planificador de tareas de Celery app.conf.beat_schedule = { \"test-schedule\": { \"task\": \"tasks.test_task\", \"schedule\": timedelta(seconds=period), }, \"test-schedule-task\": { \"task\": \"tasks.schedule_task\", \"schedule\": timedelta(minutes=60), }, \"test-statistic-task\": { \"task\": \"tasks.statistics_task\", \"schedule\": timedelta(seconds=1.2 period), }, \"test-plotting-task\": { \"task\": \"tasks.plotting_task\", \"schedule\": timedelta(seconds=1.4 period), }, }","title":"Modelos de los datos implementaci\u00f3n en python"},{"location":"modelos/#introduccion","text":"En este documento se presenta un an\u00e1lisis probabil\u00edstico de datos de radiaci\u00f3n solar usando Python.","title":"Introducci\u00f3n"},{"location":"modelos/#tareas-de-procesamiento-de-datos-con-celery","text":"Este documento describe c\u00f3mo utilizar Celery para automatizar tareas de procesamiento de datos, incluyendo la obtenci\u00f3n de datos de una API, el almacenamiento en una base de datos y el an\u00e1lisis estad\u00edstico.","title":"Tareas de Procesamiento de Datos con Celery"},{"location":"modelos/#importacion-de-librerias","text":"Importamos las librer\u00edas necesarias para manejar tareas de Celery, realizar solicitudes HTTP, procesar datos y realizar an\u00e1lisis estad\u00edsticos.","title":"Importaci\u00f3n de Librer\u00edas"},{"location":"modelos/#explicacion-del-planificador-de-tareas","text":"test-schedule : Esta tarea ejecuta test_task cada period segundos, obteniendo datos de una API y almacen\u00e1ndolos en la base de datos. test-schedule-task : Esta tarea ejecuta schedule_task cada 60 minutos, simplemente enviando un aviso de que ha pasado una hora desde el \u00faltimo aviso. test-statistic-task : Esta tarea ejecuta statistics_task cada 1.2 * period segundos, calculando momentos estad\u00edsticos de las columnas de datos y almacen\u00e1ndolos en la base de datos. test-plotting-task : Esta tarea ejecuta plotting_task cada 1.4 * period segundos, generando un histograma y comparando diferentes distribuciones de probabilidad de los datos. ```python from celery import Celery from celery.schedules import timedelta from datetime import datetime import requests import json import configparser import numpy as np from scipy import stats from scipy.stats import (kurtosis, skew, norm, uniform, rayleigh, expon, kstest, gamma, weibull_min, lognorm) import pandas as pd import matplotlib.pyplot as plt from models import session, GeneralData, PowerData, StatisticalMetrics","title":"Explicaci\u00f3n del Planificador de Tareas"},{"location":"modelos/#datos-de-configuracion","text":"config = configparser.ConfigParser() config.read(\"pipeline.cfg\") url = config[\"api\"][\"url\"] token = config[\"api\"][\"token\"] period = int(config[\"scheduler\"][\"period\"])","title":"Datos de configuraci\u00f3n"},{"location":"modelos/#crear-app-de-celery","text":"app = Celery(\"tasks\", broker=\"redis://localhost\") @app.task def test_task(): response = requests.get(url) data = json.loads(response.text) for i in range(8): temp_time = data[\"estimated_actuals\"][i][\"period_end\"] UTC_timestamp = datetime.fromisoformat(temp_time[:-2]) timestamp = UTC_timestamp - timedelta(hours=6) if session.query(GeneralData).filter_by(timestamp=timestamp).first(): pass else: power_record = PowerData( ghi=data[\"estimated_actuals\"][i][\"ghi\"], ebh=data[\"estimated_actuals\"][i][\"ebh\"], dni=data[\"estimated_actuals\"][i][\"dni\"], dhi=data[\"estimated_actuals\"][i][\"dhi\"], ) session.add(power_record) session.commit() general_record = GeneralData( timestamp=timestamp, power_id=power_record.id, cloud_opacity=data[\"estimated_actuals\"][i][\"cloud_opacity\"], ) session.add(general_record) session.commit() return \"Request de datos e inseci\u00f3n en tabla exitoso!\" @app.task def schedule_task(): return \"\u00a1Ya pas\u00f3 una hora desde el ultimo aviso!\" @app.task def statistics_task(): # Paso 1: Hacer fetch a todas las columnas y asignarlas a listas. sql_obj_temp = session.query(PowerData).all() temp_general_ghi = [] temp_general_ebh = [] temp_general_dni = [] temp_general_dhi = [] for row in sql_obj_temp: temp_general_ghi.append(row.ghi) temp_general_ebh.append(row.ebh) temp_general_dni.append(row.dni) temp_general_dhi.append(row.dhi) momentos = ['media', 'varianza', 'dsv_estandar', 'inclinacion', 'kurtosis'] idx = 0 while idx < 5: # Calculo de los momentos para cada columna de datos if idx == 0: foo_momentos = np.mean elif idx == 1: foo_momentos = np.var elif idx == 2: foo_momentos = np.std elif idx == 3: foo_momentos = skew elif idx == 4: foo_momentos = kurtosis else: pass momento_ghi = foo_momentos(temp_general_ghi) momento_ebh = foo_momentos(temp_general_ebh) momento_dni = foo_momentos(temp_general_dni) momento_dhi = foo_momentos(temp_general_dhi) # Revisar si ya se ha ingresado anteriormente momentos a la tabla statistic_obj = ( session.query(StatisticalMetrics) .filter_by(metric=momentos[idx]) .first() ) if statistic_obj: statistic_obj.ghi = momento_ghi statistic_obj.ebh = momento_ebh statistic_obj.dni = momento_dni statistic_obj.dhi = momento_dhi else: statistic_obj = StatisticalMetrics( metric=momentos[idx], ghi=momento_ghi, ebh=momento_ebh, dni=momento_dni, dhi=momento_dhi, ) session.add(statistic_obj) session.commit() idx = idx + 1 @app.task def plotting_task(): sql_obj_temp = session.query(PowerData).all() temp_general_ghi = [] for row in sql_obj_temp: temp_general_ghi.append(row.ghi) series = pd.Series(temp_general_ghi) plt.hist(series, bins=30, edgecolor='black') plt.title('Histogram') plt.xlabel('Value') plt.ylabel('Frequency') plt.savefig('histogram_plot.png') plt.clf() x = np.linspace(series.min(), series.max(), 100) pdf_normal = norm.pdf(x, series.mean(), series.std()) pdf_uniform = uniform.pdf(x, series.min(), series.max() - series.min()) pdf_rayleigh = rayleigh.pdf(x, scale=series.std()) pdf_expon = expon.pdf(x, scale=series.mean()) plt.plot(x, pdf_normal, 'k', linewidth=2, label='Normal PDF') plt.plot(x, pdf_uniform, 'r', linewidth=2, label='Uniform PDF') plt.plot(x, pdf_rayleigh, 'b', linewidth=2, label='Rayleigh PDF') plt.plot(x, pdf_expon, 'm', linewidth=2, label='Exponential PDF') plt.legend() plt.title('Probability Density Functions') plt.xlabel('Value') plt.ylabel('Density') # Save the figure plt.savefig('pdf_comparison_plot.png') plt.clf() distributions = [ norm, uniform, expon, rayleigh, gamma, weibull_min, lognorm ] results = {} for distribution in distributions: params = distribution.fit(series) ks_stat, p_value = kstest(series, distribution.name, args=params) results[distribution.name] = { 'params': params, 'ks_stat': ks_stat, 'p_value': p_value } best_fit = min(results.keys(), key=lambda dist: results[dist]['ks_stat']) best_params = results[best_fit]['params'] print(f\"Mejor ajuste: {best_fit}\") print(f\"Par\u00e1metros: {best_params}\") x = np.linspace(series.min(), series.max(), 100) pdf = getattr(stats, best_fit).pdf(x, *best_params) plt.figure(figsize=(12, 8)) plt.hist( series, bins=30, density=True, alpha=0.6, color='g', label='Datos' ) plt.plot( x, pdf, 'r-', linewidth=2, label=f'{best_fit.capitalize()} PDF' ) plt.legend(loc='best') plt.title( 'Histograma de los datos y mejor ajuste de la distribuci\u00f3n' ) plt.xlabel('Valor') plt.ylabel('Densidad') plt.savefig('mejor_ajuste_distribucion.png') equation = '' if best_fit == 'norm': mu, sigma = best_params equation = ( f\"f(x) = (1 / ({sigma} * sqrt(2 * pi))) *\" \" exp(-0.5 * ((x - {mu}) / {sigma})**2)\" ) elif best_fit == 'expon': loc, scale = best_params equation = f\"f(x) = (1 / {scale}) * exp(- (x - {loc}) / {scale})\" else: equation = \"Ecuaci\u00f3n no disponible para esta distribuci\u00f3n\" print(f\"Ecuaci\u00f3n de la distribuci\u00f3n {best_fit}:\") print(equation)","title":"Crear \"app\" de Celery"},{"location":"modelos/#configurar-el-planificador-de-tareas-de-celery","text":"app.conf.beat_schedule = { \"test-schedule\": { \"task\": \"tasks.test_task\", \"schedule\": timedelta(seconds=period), }, \"test-schedule-task\": { \"task\": \"tasks.schedule_task\", \"schedule\": timedelta(minutes=60), }, \"test-statistic-task\": { \"task\": \"tasks.statistics_task\", \"schedule\": timedelta(seconds=1.2 period), }, \"test-plotting-task\": { \"task\": \"tasks.plotting_task\", \"schedule\": timedelta(seconds=1.4 period), }, }","title":"Configurar el planificador de tareas de Celery"}]}